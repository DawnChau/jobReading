## 2-4 事务与并发控制

- 事务的并发控制就是通过**锁**机制来实现的
- 由于读事务多，写事务少，因此避免写事务阻塞读事务的方法
  - **COW 写时复制**
  - **MVCC 多版本控制**

### 2-4-1 事务

- ACID四大特性
- 允许牺牲隔离性来换取并发度
- 隔离级别
  - 读未提交：其他事务没有提交的，另一个事务也可以读。会造成脏读，即读取到另一个事务还未提交的数据。
  - 读已提交：读已经提交的数据。会造成不可重复读，即读取的多次得到不同的结果。
  - 可重复读：会造成幻读，即两次查询之间有另外一个事务插入，导致后面的查询结果出现了前面的查询中未出现的数据。
  - 序列化

### 2-4-2 并发控制

#### 2-4-2-1 数据库锁

- 解决死锁的思路：
  - 事务设置超时时间，超时自动回滚
  - 死锁检测，避免环形依赖

#### 2-4-2-2 写时复制

- 可以使得读操作不加锁

#### 2-4-2-3 多版本控制

- InnoDB包含两个隐含列：修改版本号和删除版本号
- 每个事务有自己的事务号
- 多版本控制也可以避免加锁
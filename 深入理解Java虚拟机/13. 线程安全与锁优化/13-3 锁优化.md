## 13-3 锁优化

### 13-3-1 自旋锁与自适应锁

- 自旋（默认次数为10）

- 自适应的自旋锁（动态调整自旋次数）

### 13-3-4 轻量级锁

- 轻量级锁采用CAS，当有线程来竞争时候，膨胀为重量级锁
- 如果存在锁竞争的话，除了互斥量的开销外，还额外发生了CAS操作，可能比重量级锁更慢

### 13-3-5 偏向锁

- 无竞争条件下把整个同步都消除，连CAS操作都不要了
- 有竞争时候会变成轻量级锁进而膨胀成为重量级锁

### 补充

- CAS：
  - 当多个线程尝试使用CAS同时更新同一个变量时，只有其中一个线程能更新变量的值，而其它线程都失败，失败的线程并不会被挂起，而是被告知这次竞争中失败，并可以再次尝试
  - CAS（比较并交换）是CPU指令级的操作，CAS避免了请求操作系统来裁定锁的问题，不用麻烦操作系统，直接在CPU内部就搞定了
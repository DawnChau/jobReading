## 3-4 HotSpot的算法实现

### 3-4-1 枚举根节点

- GC Root可达性分析算法对时间很敏感
- GC的时候必须停顿所有的Java线程，被称为Stop the World





### 3-4-2 安全点

- OopMap可以帮助HotSpot快速完成GC Roots的枚举

- HotSpot不会为每条指令都生成OopMap，只有在特定的位置，即安全点才会生成

- 程序只有在安全点才能停下来

- 主动式中断思想是当GC需要中断线程时，不直接对线程操作，而是设置一个标志。每个线程主动去轮询这个标志，发现中断标志为真时就自己中断挂起，轮询的地方和安全点是重合的

- 抢先式中断：发生GC时，先把所有线程全部中断，如果发现线程不在安全点上，就恢复线程，让其跑到安全点上，当前没有虚拟机采用这种方法。

  

### 3-4-3 安全区域

- 暂时休眠的线程不会设置安全点，而是放在安全区域中
- 安全区域中任何时间发生GC都是线程安全的
- 安全区域中的线程要等待枚举GC Roots完成才能离开安全区域

